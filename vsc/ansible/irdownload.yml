---
- name: Irdownload
  hosts: localhost
  become: yes  # Execute tasks with sudo privileges

  tasks:
    - name: Update apt packages
      apt:
        update_cache: yes

    - name: Install required packages
      apt:
        name: "{{ item }}"
        state: present
      loop:
        - apt-transport-https
        - ca-certificates
        - gnupg
        - curl
        - sudo

    - name: Add Google Cloud SDK repository
      lineinfile:
        dest: /etc/apt/sources.list.d/google-cloud-sdk.list
        line: "deb [signed-by=/usr/share/keyrings/cloud.google.asc] https://packages.cloud.google.com/apt cloud-sdk main"
        create: yes

    - name: Import Google Cloud SDK key
      shell: "curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo tee /usr/share/keyrings/cloud.google.asc"
      args:
        warn: false

    - name: Update apt packages with Google Cloud SDK repository
      apt:
        update_cache: yes
        force_apt_get: yes

    - name: Install Google Cloud CLI
      shell: "apt-get install google-cloud-cli"

    - name: Create tmux session
      command: "tmux new-session -d -s download_session"
      ignore_errors: true

    - name: Run download scripts in parallel
      command: "tmux send-keys -t irsessions:{{ item.name }} './irdownload {{ item.script }}' Enter"
      loop:
        - { name: "window1", script: "BIND_TRANSLATION" }
        - { name: "window2", script: "BIOGRID" }
        - { name: "window3", script: "CORUM" }
        - { name: "window4", script: "DIP" }
        - { name: "window5", script: "HPRD" }
        - { name: "window6", script: "INTACT" }
        - { name: "window7", script: "INTCOMPLEX" }
        - { name: "window8", script: "MPACT" }
        - { name: "window9", script: "MPPI" }
        - { name: "window10", script: "BAR" }
        - { name: "window11", script: "BHF_UCL" }
        - { name: "window12", script: "HPIDB" }
        - { name: "window13", script: "HURI" }
        - { name: "window14", script: "IMEX" }
        - { name: "window15", script: "INNATEDB" }
        - { name: "window16", script: "MATRIXDB" }
        - { name: "window17", script: "MBINFO" }
        - { name: "window18", script: "MINT" }
        - { name: "window19", script: "MPIDB" }
        - { name: "window20", script: "QUICKGO" }
        - { name: "window21", script: "REACTOME" }
        - { name: "window22", script: "UNIPROTPP" }
        - { name: "window23", script: "VIRUSHOST" }
        - { name: "window24", script: "PSI_MI" }
        - { name: "window25", script: "TAXONOMY" }
        - { name: "window26", script: "ATHALIANA" }
        - { name: "window27", script: "BIND" }
        - { name: "window28", script: "DIG" }
        - { name: "window29", script: "FLY" }
        - { name: "window30", script: "GENE" }
        - { name: "window31", script: "GENPEPT" }
        - { name: "window32", script: "IPI" }
        - { name: "window33", script: "MMDB" }
        - { name: "window34", script: "PDB" }
        - { name: "window35", script: "REFSEQ" }
        - { name: "window36", script: "UNIPROT" }
        - { name: "window37", script: "YEAST" }

    - name: Show download summary
      command: "tmux attach-session -t irsessions"
