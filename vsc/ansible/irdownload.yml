---
- name: Irdownload
  hosts: localhost
  become: yes  # Execute tasks with sudo privileges

  tasks:
    - name: Update apt packages
      apt:
        update_cache: yes

    - name: Install required packages
      apt:
        name: "{{ item }}"
        state: present
      loop:
        - apt-transport-https
        - ca-certificates
        - gnupg
        - curl
        - sudo

    - name: Add Google Cloud SDK repository
      lineinfile:
        dest: /etc/apt/sources.list.d/google-cloud-sdk.list
        line: "deb [signed-by=/usr/share/keyrings/cloud.google.asc] https://packages.cloud.google.com/apt cloud-sdk main"
        create: yes

    - name: Import Google Cloud SDK key
      shell: "curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo tee /usr/share/keyrings/cloud.google.asc"
      args:
        warn: false

    - name: Update apt packages with Google Cloud SDK repository
      apt:
        update_cache: yes
        force_apt_get: yes

    - name: Install Google Cloud CLI
      shell: "apt-get install google-cloud-cli"

    - name: Kill existing tmux session
      command: "tmux kill-session -t irsessions"
      ignore_errors: true

    - name: Create tmux session for downloads
      command: "tmux new-session -d -s irsessions"

    - name: Run download scripts in parallel
      command: "tmux send-keys -t irsessions:{{ 'window' ~ item.0 + 1 }} './irdownload {{ item.1 }}' Enter"
      loop: "{{ windows_scripts }}"

    - name: Show download summary
      command: "tmux attach-session -t irsessions"

  vars:
    windows_scripts:
      - [ 0, "BIND_TRANSLATION" ]
      - [ 1, "BIOGRID" ]
      - [ 2, "CORUM" ]
      - [ 3, "DIP" ]
      - [ 4, "HPRD" ]
      - [ 5, "INTACT" ]
      - [ 6, "INTCOMPLEX" ]
      - [ 7, "MPACT" ]
      - [ 8, "MPPI" ]
      - [ 9, "BAR" ]
      - [ 10, "BHF_UCL" ]
      - [ 11, "HPIDB" ]
      - [ 12, "HURI" ]
      - [ 13, "IMEX" ]
      - [ 14, "INNATEDB" ]
      - [ 15, "MATRIXDB" ]
      - [ 16, "MBINFO" ]
      - [ 17, "MINT" ]
      - [ 18, "MPIDB" ]
      - [ 19, "QUICKGO" ]
      - [ 20, "REACTOME" ]
      - [ 21, "UNIPROTPP" ]
      - [ 22, "VIRUSHOST" ]
      - [ 23, "PSI_MI" ]
      - [ 24, "TAXONOMY" ]
      - [ 25, "ATHALIANA" ]
      - [ 26, "BIND" ]
      - [ 27, "DIG" ]
      - [ 28, "FLY" ]
      - [ 29, "GENE" ]
      - [ 30, "GENPEPT" ]
      - [ 31, "IPI" ]
      - [ 32, "MMDB" ]
      - [ 33, "PDB" ]
      - [ 34, "REFSEQ" ]
      - [ 35, "UNIPROT" ]
      - [ 36, "YEAST" ]
